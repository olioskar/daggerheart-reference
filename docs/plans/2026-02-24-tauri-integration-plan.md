# Tauri v2 Integration — Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Wrap the Daggerheart reference app in a native macOS window using Tauri v2.

**Architecture:** Tauri creates a `src-tauri/` Rust project alongside the existing Vite frontend. The Vite dev server feeds the WebView during development; production builds bundle the `dist/` output into a native binary. The web app code is untouched except for a conditional `base` path in `vite.config.js`.

**Tech Stack:** Tauri v2, Rust (via rustup), @tauri-apps/cli

---

### Task 1: Install Rust

**Why:** Tauri's native shell is written in Rust. This is a system-level prerequisite.

**Step 1: Install rustup and Rust toolchain**

Run:
```bash
curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh -s -- -y
```

The `-y` flag accepts defaults (stable toolchain, adds to PATH).

**Step 2: Load Rust into current shell**

Run:
```bash
source "$HOME/.cargo/env"
```

**Step 3: Verify installation**

Run:
```bash
rustc --version && cargo --version
```

Expected: Version numbers for both (e.g., `rustc 1.8x.x`, `cargo 1.8x.x`).

---

### Task 2: Install Tauri CLI and initialize project

**Files:**
- Modify: `package.json` (new devDependency + scripts)
- Create: `src-tauri/` directory (generated by `tauri init`)

**Step 1: Install the Tauri CLI**

Run:
```bash
npm install -D @tauri-apps/cli@latest
```

**Step 2: Initialize Tauri**

Run `npx tauri init` and provide these values at the prompts:

| Prompt | Value |
|--------|-------|
| App name | `daggerheart-reference` |
| Window title | `Bench Notes — Daggerheart Reference` |
| Web assets location | `../dist` |
| Dev server URL | `http://localhost:5173` |
| Frontend dev command | `npm run dev` |
| Frontend build command | `npm run build` |

This creates `src-tauri/` with `Cargo.toml`, `src/main.rs`, `tauri.conf.json`, and default icons.

**Step 3: Verify the scaffolded files exist**

Run:
```bash
ls src-tauri/src/main.rs src-tauri/Cargo.toml src-tauri/tauri.conf.json
```

Expected: All three files listed without errors.

**Step 4: Commit**

```bash
git add package.json package-lock.json src-tauri/
git commit -m "feat: add Tauri v2 scaffolding"
```

---

### Task 3: Configure vite.config.js for conditional base path

**Files:**
- Modify: `vite.config.js`

**Why:** The web app uses `base: '/daggerheart-reference/'` for GitHub Pages, but Tauri serves from root (`/`). Tauri sets `TAURI_ENV_PLATFORM` during dev and build, so we use that to detect the environment.

**Step 1: Update vite.config.js**

Replace the entire file with:

```js
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  base: process.env.TAURI_ENV_PLATFORM ? '/' : '/daggerheart-reference/',
  plugins: [
    react(),
  ],
})
```

**Step 2: Verify GitHub Pages build still works**

Run:
```bash
npm run build
```

Expected: Clean build to `dist/`. Check that `dist/index.html` still references `/daggerheart-reference/` in its asset paths (since `TAURI_ENV_PLATFORM` won't be set).

**Step 3: Commit**

```bash
git add vite.config.js
git commit -m "fix: conditional base path for Tauri vs GitHub Pages"
```

---

### Task 4: Update tauri.conf.json

**Files:**
- Modify: `src-tauri/tauri.conf.json`

**Why:** Set a proper identifier, reasonable window size for the reference app, and remove dev/build commands (we'll manage these via npm scripts).

**Step 1: Edit tauri.conf.json**

Ensure these values are set (the init may have set some already — adjust as needed):

```json
{
  "productName": "Bench Notes",
  "version": "0.1.0",
  "identifier": "io.github.olioskar.daggerheart-reference",
  "build": {
    "devUrl": "http://localhost:5173",
    "frontendDist": "../dist",
    "beforeDevCommand": "npm run dev",
    "beforeBuildCommand": "npm run build"
  },
  "app": {
    "windows": [
      {
        "label": "main",
        "title": "Bench Notes — Daggerheart Reference",
        "width": 600,
        "height": 900,
        "resizable": true,
        "fullscreen": false
      }
    ]
  },
  "bundle": {
    "active": true,
    "targets": "all"
  }
}
```

Window is 600x900 to match the single-column mobile-ish layout the app is designed for.

**Step 2: Commit**

```bash
git add src-tauri/tauri.conf.json
git commit -m "chore: configure Tauri window and app identity"
```

---

### Task 5: Add npm scripts for Tauri

**Files:**
- Modify: `package.json`

**Step 1: Add tauri scripts to package.json**

Add to the `"scripts"` section:

```json
"tauri:dev": "tauri dev",
"tauri:build": "tauri build"
```

**Step 2: Commit**

```bash
git add package.json
git commit -m "chore: add tauri:dev and tauri:build npm scripts"
```

---

### Task 6: First launch — verify it works

**Step 1: Run the Tauri dev server**

Run:
```bash
npm run tauri:dev
```

Expected: Rust compiles (first run takes 1-3 minutes), then a native macOS window opens showing the Daggerheart reference app. The Vite dev server runs in the background with HMR.

**Step 2: Verify basic functionality**

In the native window:
- Search works (type in the search bar)
- Filter pills work (click categories)
- Theme toggle works (dark/light)
- Scrolling is smooth

**Step 3: Close the app and verify clean shutdown**

Close the window or Ctrl+C the terminal. No errors expected.

---

### Task 7: Add src-tauri to .gitignore (build artifacts only)

**Files:**
- Modify: `.gitignore`

**Why:** The `src-tauri/target/` directory contains Rust build artifacts (can be gigabytes). The source files in `src-tauri/` should be tracked.

**Step 1: Add Tauri build artifacts to .gitignore**

Append to `.gitignore`:

```
# Tauri
src-tauri/target/
```

**Step 2: Commit**

```bash
git add .gitignore
git commit -m "chore: gitignore Tauri build artifacts"
```
